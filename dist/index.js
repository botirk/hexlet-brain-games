"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.playGame = exports.gameOfPrime = exports.gameOfProgression = exports.gameOfGCD = exports.gameOfCalc = exports.gameOfEven = exports.congratulate = exports.questionNameAndSayHello = exports.sayWelcome = void 0;

var _readlineSync = _interopRequireDefault(require("readline-sync"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const sayWelcome = () => {
  console.log('\nWelcome to the Brain Games!');
};

exports.sayWelcome = sayWelcome;

const questionNameAndSayHello = () => {
  const name = _readlineSync.default.question('\nMay I have your name? ');

  console.log(`\nHello, ${name}`);
  return name;
};

exports.questionNameAndSayHello = questionNameAndSayHello;

const congratulate = name => console.log(`\nCongratulations, ${name}!`); // every game returns [string, function] function is generator of [question, answer]


exports.congratulate = congratulate;

const gameOfEven = (maxNum = 50) => () => {
  const instruction = 'Anwser "yes" if number even otherwise answer "no"';

  const generator = () => {
    const generatedNumber = Math.floor(Math.random() * maxNum);
    const isEven = generatedNumber % 2 === 0;
    const result = isEven ? 'yes' : 'no';
    return [generatedNumber, result];
  };

  return [instruction, generator];
};

exports.gameOfEven = gameOfEven;

const gameOfCalc = (maxNum = 50, maxNum2 = maxNum / 5) => () => {
  const instruction = 'What is result of the expression?';

  const generator = () => {
    const genNum1 = Math.floor(Math.random() * maxNum);
    const genNum2 = Math.floor(Math.random() * maxNum2);
    const expSymbols = [{
      str: '+',
      f: (a, b) => a + b
    }, {
      str: '-',
      f: (a, b) => a - b
    }, {
      str: '*',
      f: (a, b) => a * b
    }];
    const transSymbol = expSymbols[Math.floor(Math.random() * 3)];
    const genQuestion = `${genNum1} ${transSymbol.str} ${genNum2}`;
    const result = String(transSymbol.f(genNum1, genNum2));
    return [genQuestion, result];
  };

  return [instruction, generator];
};

exports.gameOfCalc = gameOfCalc;

const gameOfGCD = (maxNum = 50) => () => {
  const instruction = 'Find the greatest common divisor of given numbers.';

  const generator = () => {
    const genNum1 = Math.floor(Math.random() * maxNum);
    const genNum2 = Math.floor(Math.random() * maxNum);

    const nod = (a, b) => b > 0 ? nod(b, a % b) : a;

    const genNOD = String(nod(genNum1, genNum2));
    const genQuestion = `${genNum1} ${genNum2}`;
    return [genQuestion, genNOD];
  };

  return [instruction, generator];
};

exports.gameOfGCD = gameOfGCD;

const gameOfProgression = (maxNum = 50, progCount = 10, minStep = 2, maxStep = minStep + 9) => () => {
  // you cant guess progression with less than 3 numbers, so fix it
  const alteredProgCount = progCount < 3 ? 3 : progCount;
  const instruction = 'What number is missing in the progression?';

  const generator = () => {
    const step = minStep + Math.floor(Math.random() * maxStep); // iterative process - generates array

    const genIter = (result, lastNum, i) => {
      if (i === 0) return result;
      const newLastNum = lastNum + step;
      result.push(newLastNum);
      return genIter(result, newLastNum, i - 1);
    };

    const genProgression = genIter([], Math.floor(Math.random() * maxNum), alteredProgCount); // generated missing number index

    const genMissingNumIndex = Math.floor(Math.random() * alteredProgCount);
    const answer = String(genProgression[genMissingNumIndex]); // replace missing index with two dots

    genProgression[genMissingNumIndex] = '..';
    const question = genProgression.join(' ');
    return [question, answer];
  };

  return [instruction, generator];
};

exports.gameOfProgression = gameOfProgression;

const gameOfPrime = (maxNum = 50) => () => {
  const instruction = 'Answer "yes" if given number is prime. Otherwise answer "no"';

  const generator = () => {
    const genNum = Math.floor(Math.random() * maxNum);

    const fIsPrime = n => {
      if (n === 1) return false;
      if (n === 2) return true;

      for (let i = 2; i < n; i += 1) if (n % i === 0) return false;

      return true;
    };

    const answer = fIsPrime(genNum) ? 'yes' : 'no';
    return [genNum, answer];
  };

  return [instruction, generator];
};

exports.gameOfPrime = gameOfPrime;

const playGame = (game, numCorrectGames = 3) => {
  sayWelcome();
  const name = questionNameAndSayHello();
  const [instruction, generator] = game();
  console.log(`\n${instruction}`);

  for (let i = 0; i < numCorrectGames;) {
    const [question, answer] = generator();

    const userAnswer = _readlineSync.default.question(`\nQuestion: ${question}\nYour answer: `);

    if (userAnswer === answer) {
      console.log('Correct!');
      i += 1;
    } else console.log(`'${userAnswer}' is wrong answer ;(. Correct answer was '${answer}'`);
  }

  congratulate(name);
};

exports.playGame = playGame;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9pbmRleC5qcyJdLCJuYW1lcyI6WyJzYXlXZWxjb21lIiwiY29uc29sZSIsImxvZyIsInF1ZXN0aW9uTmFtZUFuZFNheUhlbGxvIiwibmFtZSIsInJlYWRsaW5lU3luYyIsInF1ZXN0aW9uIiwiY29uZ3JhdHVsYXRlIiwiZ2FtZU9mRXZlbiIsIm1heE51bSIsImluc3RydWN0aW9uIiwiZ2VuZXJhdG9yIiwiZ2VuZXJhdGVkTnVtYmVyIiwiTWF0aCIsImZsb29yIiwicmFuZG9tIiwiaXNFdmVuIiwicmVzdWx0IiwiZ2FtZU9mQ2FsYyIsIm1heE51bTIiLCJnZW5OdW0xIiwiZ2VuTnVtMiIsImV4cFN5bWJvbHMiLCJzdHIiLCJmIiwiYSIsImIiLCJ0cmFuc1N5bWJvbCIsImdlblF1ZXN0aW9uIiwiU3RyaW5nIiwiZ2FtZU9mR0NEIiwibm9kIiwiZ2VuTk9EIiwiZ2FtZU9mUHJvZ3Jlc3Npb24iLCJwcm9nQ291bnQiLCJtaW5TdGVwIiwibWF4U3RlcCIsImFsdGVyZWRQcm9nQ291bnQiLCJzdGVwIiwiZ2VuSXRlciIsImxhc3ROdW0iLCJpIiwibmV3TGFzdE51bSIsInB1c2giLCJnZW5Qcm9ncmVzc2lvbiIsImdlbk1pc3NpbmdOdW1JbmRleCIsImFuc3dlciIsImpvaW4iLCJnYW1lT2ZQcmltZSIsImdlbk51bSIsImZJc1ByaW1lIiwibiIsInBsYXlHYW1lIiwiZ2FtZSIsIm51bUNvcnJlY3RHYW1lcyIsInVzZXJBbnN3ZXIiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQTs7OztBQUVBLE1BQU1BLFVBQVUsR0FBRyxNQUFNO0FBQ3ZCQyxFQUFBQSxPQUFPLENBQUNDLEdBQVIsQ0FBWSwrQkFBWjtBQUNELENBRkQ7Ozs7QUFJQSxNQUFNQyx1QkFBdUIsR0FBRyxNQUFNO0FBQ3BDLFFBQU1DLElBQUksR0FBR0Msc0JBQWFDLFFBQWIsQ0FBc0IsMEJBQXRCLENBQWI7O0FBQ0FMLEVBQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFhLFlBQVdFLElBQUssRUFB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LElBQUQsQ0FBWjtBQUNELENBZkQiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgcmVhZGxpbmVTeW5jIGZyb20gJ3JlYWRsaW5lLXN5bmMnO1xuXG5jb25zdCBzYXlXZWxjb21lID0gKCkgPT4ge1xuICBjb25zb2xlLmxvZygnXFxuV2VsY29tZSB0byB0aGUgQnJhaW4gR2FtZXMhJyk7XG59O1xuXG5jb25zdCBxdWVzdGlvbk5hbWVBbmRTYXlIZWxsbyA9ICgpID0+IHtcbiAgY29uc3QgbmFtZSA9IHJlYWRsaW5lU3luYy5xdWVzdGlvbignXFxuTWF5IEkgaGF2ZSB5b3VyIG5hbWU/ICcpO1xuICBjb25zb2xlLmxvZyhgXFxuSGVsbG8sICR7bmFtZX1gKTtcbiAgcmV0dXJuIG5hbWU7XG59O1xuXG5jb25zdCBjb25ncmF0dWxhdGUgPSBuYW1lID0+IGNvbnNvbGUubG9nKGBcXG5Db25ncmF0dWxhdGlvbnMsICR7bmFtZX0hYCk7XG4vLyBldmVyeSBnYW1lIHJldHVybnMgW3N0cmluZywgZnVuY3Rpb25dIGZ1bmN0aW9uIGlzIGdlbmVyYXRvciBvZiBbcXVlc3Rpb24sIGFuc3dlcl1cbmNvbnN0IGdhbWVPZkV2ZW4gPSAobWF4TnVtID0gNTApID0+ICgpID0+IHtcbiAgY29uc3QgaW5zdHJ1Y3Rpb24gPSAnQW53c2VyIFwieWVzXCIgaWYgbnVtYmVyIGV2ZW4gb3RoZXJ3aXNlIGFuc3dlciBcIm5vXCInO1xuICBjb25zdCBnZW5lcmF0b3IgPSAoKSA9PiB7XG4gICAgY29uc3QgZ2VuZXJhdGVkTnVtYmVyID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogbWF4TnVtKTtcbiAgICBjb25zdCBpc0V2ZW4gPSAoZ2VuZXJhdGVkTnVtYmVyICUgMiA9PT0gMCk7XG4gICAgY29uc3QgcmVzdWx0ID0gKGlzRXZlbiA/ICd5ZXMnIDogJ25vJyk7XG4gICAgcmV0dXJuIFtnZW5lcmF0ZWROdW1iZXIsIHJlc3VsdF07XG4gIH07XG4gIHJldHVybiBbaW5zdHJ1Y3Rpb24sIGdlbmVyYXRvcl07XG59O1xuXG5jb25zdCBnYW1lT2ZDYWxjID0gKG1heE51bSA9IDUwLCBtYXhOdW0yID0gbWF4TnVtIC8gNSkgPT4gKCkgPT4ge1xuICBjb25zdCBpbnN0cnVjdGlvbiA9ICdXaGF0IGlzIHJlc3VsdCBvZiB0aGUgZXhwcmVzc2lvbj8nO1xuICBjb25zdCBnZW5lcmF0b3IgPSAoKSA9PiB7XG4gICAgY29uc3QgZ2VuTnVtMSA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIG1heE51bSk7XG4gICAgY29uc3QgZ2VuTnVtMiA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIG1heE51bTIpO1xuICAgIGNvbnN0IGV4cFN5bWJvbHMgPSBbXG4gICAgICB7IHN0cjogJysnLCBmOiAoYSwgYikgPT4gYSArIGIgfSxcbiAgICAgIHsgc3RyOiAnLScsIGY6IChhLCBiKSA9PiBhIC0gYiB9LFxuICAgICAgeyBzdHI6ICcqJywgZjogKGEsIGIpID0+IGEgKiBiIH0sXG4gICAgXTtcbiAgICBjb25zdCB0cmFuc1N5bWJvbCA9IGV4cFN5bWJvbHNbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMyldO1xuICAgIGNvbnN0IGdlblF1ZXN0aW9uID0gYCR7Z2VuTnVtMX0gJHt0cmFuc1N5bWJvbC5zdHJ9ICR7Z2VuTnVtMn1gO1xuICAgIGNvbnN0IHJlc3VsdCA9IFN0cmluZyh0cmFuc1N5bWJvbC5mKGdlbk51bTEsIGdlbk51bTIpKTtcbiAgICByZXR1cm4gW2dlblF1ZXN0aW9uLCByZXN1bHRdO1xuICB9O1xuICByZXR1cm4gW2luc3RydWN0aW9uLCBnZW5lcmF0b3JdO1xufTtcblxuY29uc3QgZ2FtZU9mR0NEID0gKG1heE51bSA9IDUwKSA9PiAoKSA9PiB7XG4gIGNvbnN0IGluc3RydWN0aW9uID0gJ0ZpbmQgdGhlIGdyZWF0ZXN0IGNvbW1vbiBkaXZpc29yIG9mIGdpdmVuIG51bWJlcnMuJztcbiAgY29uc3QgZ2VuZXJhdG9yID0gKCkgPT4ge1xuICAgIGNvbnN0IGdlbk51bTEgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBtYXhOdW0pO1xuICAgIGNvbnN0IGdlbk51bTIgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBtYXhOdW0pO1xuICAgIGNvbnN0IG5vZCA9IChhLCBiKSA9PiAoYiA+IDAgPyBub2QoYiwgYSAlIGIpIDogYSk7XG4gICAgY29uc3QgZ2VuTk9EID0gU3RyaW5nKG5vZChnZW5OdW0xLCBnZW5OdW0yKSk7XG4gICAgY29uc3QgZ2VuUXVlc3Rpb24gPSBgJHtnZW5OdW0xfSAke2dlbk51bTJ9YDtcbiAgICByZXR1cm4gW2dlblF1ZXN0aW9uLCBnZW5OT0RdO1xuICB9O1xuICByZXR1cm4gW2luc3RydWN0aW9uLCBnZW5lcmF0b3JdO1xufTtcblxuY29uc3QgZ2FtZU9mUHJvZ3Jlc3Npb24gPSAobWF4TnVtID0gNTAsIHByb2dDb3VudCA9IDEwLCBtaW5TdGVwID0gMixcbiAgbWF4U3RlcCA9IG1pblN0ZXAgKyA5KSA9PiAoKSA9PiB7XG4gIC8vIHlvdSBjYW50IGd1ZXNzIHByb2dyZXNzaW9uIHdpdGggbGVzcyB0aGFuIDMgbnVtYmVycywgc28gZml4IGl0XG4gIGNvbnN0IGFsdGVyZWRQcm9nQ291bnQgPSBwcm9nQ291bnQgPCAzID8gMyA6IHByb2dDb3VudDtcbiAgY29uc3QgaW5zdHJ1Y3Rpb24gPSAnV2hhdCBudW1iZXIgaXMgbWlzc2luZyBpbiB0aGUgcHJvZ3Jlc3Npb24/JztcbiAgY29uc3QgZ2VuZXJhdG9yID0gKCkgPT4ge1xuICAgIGNvbnN0IHN0ZXAgPSBtaW5TdGVwICsgTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogbWF4U3RlcCk7XG4gICAgLy8gaXRlcmF0aXZlIHByb2Nlc3MgLSBnZW5lcmF0ZXMgYXJyYXlcbiAgICBjb25zdCBnZW5JdGVyID0gKHJlc3VsdCwgbGFzdE51bSwgaSkgPT4ge1xuICAgICAgaWYgKGkgPT09IDApIHJldHVybiByZXN1bHQ7XG4gICAgICBjb25zdCBuZXdMYXN0TnVtID0gbGFzdE51bSArIHN0ZXA7XG4gICAgICByZXN1bHQucHVzaChuZXdMYXN0TnVtKTtcbiAgICAgIHJldHVybiBnZW5JdGVyKHJlc3VsdCwgbmV3TGFzdE51bSwgaSAtIDEpO1xuICAgIH07XG4gICAgY29uc3QgZ2VuUHJvZ3Jlc3Npb24gPSBnZW5JdGVyKFtdLCBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBtYXhOdW0pLCBhbHRlcmVkUHJvZ0NvdW50KTtcbiAgICAvLyBnZW5lcmF0ZWQgbWlzc2luZyBudW1iZXIgaW5kZXhcbiAgICBjb25zdCBnZW5NaXNzaW5nTnVtSW5kZXggPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBhbHRlcmVkUHJvZ0NvdW50KTtcbiAgICBjb25zdCBhbnN3ZXIgPSBTdHJpbmcoZ2VuUHJvZ3Jlc3Npb25bZ2VuTWlzc2luZ051bUluZGV4XSk7XG4gICAgLy8gcmVwbGFjZSBtaXNzaW5nIGluZGV4IHdpdGggdHdvIGRvdHNcbiAgICBnZW5Qcm9ncmVzc2lvbltnZW5NaXNzaW5nTnVtSW5kZXhdID0gJy4uJztcbiAgICBjb25zdCBxdWVzdGlvbiA9IGdlblByb2dyZXNzaW9uLmpvaW4oJyAnKTtcbiAgICByZXR1cm4gW3F1ZXN0aW9uLCBhbnN3ZXJdO1xuICB9O1xuICByZXR1cm4gW2luc3RydWN0aW9uLCBnZW5lcmF0b3JdO1xufTtcblxuY29uc3QgZ2FtZU9mUHJpbWUgPSAobWF4TnVtID0gNTApID0+ICgpID0+IHtcbiAgY29uc3QgaW5zdHJ1Y3Rpb24gPSAnQW5zd2VyIFwieWVzXCIgaWYgZ2l2ZW4gbnVtYmVyIGlzIHByaW1lLiBPdGhlcndpc2UgYW5zd2VyIFwibm9cIic7XG4gIGNvbnN0IGdlbmVyYXRvciA9ICgpID0+IHtcbiAgICBjb25zdCBnZW5OdW0gPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBtYXhOdW0pO1xuICAgIGNvbnN0IGZJc1ByaW1lID0gKG4pID0+IHtcbiAgICAgIGlmIChuID09PSAxKSByZXR1cm4gZmFsc2U7XG4gICAgICBpZiAobiA9PT0gMikgcmV0dXJuIHRydWU7XG4gICAgICBmb3IgKGxldCBpID0gMjsgaSA8IG47IGkgKz0gMSkgaWYgKG4gJSBpID09PSAwKSByZXR1cm4gZmFsc2U7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9O1xuICAgIGNvbnN0IGFuc3dlciA9IGZJc1ByaW1lKGdlbk51bSkgPyAneWVzJyA6ICdubyc7XG4gICAgcmV0dXJuIFtnZW5OdW0sIGFuc3dlcl07XG4gIH07XG4gIHJldHVybiBbaW5zdHJ1Y3Rpb24sIGdlbmVyYXRvcl07XG59O1xuXG5jb25zdCBwbGF5R2FtZSA9IChnYW1lLCBudW1Db3JyZWN0R2FtZXMgPSAzKSA9PiB7XG4gIHNheVdlbGNvbWUoKTtcbiAgY29uc3QgbmFtZSA9IHF1ZXN0aW9uTmFtZUFuZFNheUhlbGxvKCk7XG5cbiAgY29uc3QgW2luc3RydWN0aW9uLCBnZW5lcmF0b3JdID0gZ2FtZSgpO1xuICBjb25zb2xlLmxvZyhgXFxuJHtpbnN0cnVjdGlvbn1gKTtcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1Db3JyZWN0R2FtZXM7KSB7XG4gICAgY29uc3QgW3F1ZXN0aW9uLCBhbnN3ZXJdID0gZ2VuZXJhdG9yKCk7XG4gICAgY29uc3QgdXNlckFuc3dlciA9IHJlYWRsaW5lU3luYy5xdWVzdGlvbihgXFxuUXVlc3Rpb246ICR7cXVlc3Rpb259XFxuWW91ciBhbnN3ZXI6IGApO1xuICAgIGlmICh1c2VyQW5zd2VyID09PSBhbnN3ZXIpIHtcbiAgICAgIGNvbnNvbGUubG9nKCdDb3JyZWN0IScpO1xuICAgICAgaSArPSAxO1xuICAgIH0gZWxzZSBjb25zb2xlLmxvZyhgJyR7dXNlckFuc3dlcn0nIGlzIHdyb25nIGFuc3dlciA7KC4gQ29ycmVjdCBhbnN3ZXIgd2FzICcke2Fuc3dlcn0nYCk7XG4gIH1cbiAgY29uZ3JhdHVsYXRlKG5hbWUpO1xufTtcblxuZXhwb3J0IHtcbiAgc2F5V2VsY29tZSwgcXVlc3Rpb25OYW1lQW5kU2F5SGVsbG8sIGNvbmdyYXR1bGF0ZSxcbiAgZ2FtZU9mRXZlbiwgZ2FtZU9mQ2FsYywgZ2FtZU9mR0NELCBnYW1lT2ZQcm9ncmVzc2lvbixcbiAgZ2FtZU9mUHJpbWUsIHBsYXlHYW1lLFxufTtcbiJdfQ==