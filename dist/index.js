"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.playGame = exports.gameOfProgression = exports.gameOfGCD = exports.gameOfCalc = exports.gameOfEven = exports.congratulate = exports.questionNameAndSayHello = exports.sayWelcome = void 0;

var _readlineSync = _interopRequireDefault(require("readline-sync"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const sayWelcome = () => {
  console.log('\nWelcome to the Brain Games!');
};

exports.sayWelcome = sayWelcome;

const questionNameAndSayHello = () => {
  const name = _readlineSync.default.question('\nMay I have your name? ');

  console.log(`\nHello, ${name}`);
  return name;
};

exports.questionNameAndSayHello = questionNameAndSayHello;

const congratulate = name => console.log(`\nCongratulations, ${name}!`); // every game returns [string, function] function is generator of [question, answer]


exports.congratulate = congratulate;

const gameOfEven = (maxNum = 50) => () => {
  const instruction = 'Anwser "yes" if number even otherwise answer "no"';

  const generator = () => {
    const generatedNumber = Math.floor(Math.random() * maxNum);
    const isEven = generatedNumber % 2 === 0;
    const result = isEven ? 'yes' : 'no';
    return [generatedNumber, result];
  };

  return [instruction, generator];
};

exports.gameOfEven = gameOfEven;

const gameOfCalc = (maxNum = 50, maxNum2 = maxNum / 5) => () => {
  const instruction = 'What is result of the expression?';

  const generator = () => {
    const genNum1 = Math.floor(Math.random() * maxNum);
    const genNum2 = Math.floor(Math.random() * maxNum2);
    const expSymbols = [{
      str: '+',
      f: (a, b) => a + b
    }, {
      str: '-',
      f: (a, b) => a - b
    }, {
      str: '*',
      f: (a, b) => a * b
    }];
    const transSymbol = expSymbols[Math.floor(Math.random() * 3)];
    const genQuestion = `${genNum1} ${transSymbol.str} ${genNum2}`;
    const result = String(transSymbol.f(genNum1, genNum2));
    return [genQuestion, result];
  };

  return [instruction, generator];
};

exports.gameOfCalc = gameOfCalc;

const gameOfGCD = (maxNum = 50) => () => {
  const instruction = 'Find the greatest common divisor of given numbers.';

  const generator = () => {
    const genNum1 = Math.floor(Math.random() * maxNum);
    const genNum2 = Math.floor(Math.random() * maxNum);

    const nod = (a, b) => b > 0 ? nod(b, a % b) : a;

    const genNOD = String(nod(genNum1, genNum2));
    const genQuestion = `${genNum1} ${genNum2}`;
    return [genQuestion, genNOD];
  };

  return [instruction, generator];
};

exports.gameOfGCD = gameOfGCD;

const gameOfProgression = (maxNum = 50, progCount = 10, minStep = 2, maxStep = minStep + 9) => () => {
  // you cant guess progression with less than 3 numbers, so fix it
  const alteredProgCount = progCount < 3 ? 3 : progCount;
  const instruction = 'What number is missing in the progression?';

  const generator = () => {
    const step = minStep + Math.floor(Math.random() * maxStep); // iterative process - generates array

    const genIter = (result, lastNum, i) => {
      if (i === 0) return result;
      const newLastNum = lastNum + step;
      result.push(newLastNum);
      return genIter(result, newLastNum, i - 1);
    };

    const genProgression = genIter([], Math.floor(Math.random() * maxNum), alteredProgCount); // generated missing number index

    const genMissingNumIndex = Math.floor(Math.random() * alteredProgCount);
    const answer = String(genProgression[genMissingNumIndex]); // replace missing index with two dots

    genProgression[genMissingNumIndex] = '..';
    const question = genProgression.join(' ');
    return [question, answer];
  };

  return [instruction, generator];
};

exports.gameOfProgression = gameOfProgression;

const playGame = (game, numCorrectGames = 3) => {
  sayWelcome();
  const name = questionNameAndSayHello();
  const [instruction, generator] = game();
  console.log(`\n${instruction}`);

  for (let i = 0; i < numCorrectGames;) {
    const [question, answer] = generator();

    const userAnswer = _readlineSync.default.question(`\nQuestion: ${question}\nYour answer: `);

    if (userAnswer === answer) {
      console.log('Correct!');
      i += 1;
    } else console.log(`'${userAnswer}' is wrong answer ;(. Correct answer was '${answer}'`);
  }

  congratulate(name);
};

exports.playGame = playGame;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9pbmRleC5qcyJdLCJuYW1lcyI6WyJzYXlXZWxjb21lIiwiY29uc29sZSIsImxvZyIsInF1ZXN0aW9uTmFtZUFuZFNheUhlbGxvIiwibmFtZSIsInJlYWRsaW5lU3luYyIsInF1ZXN0aW9uIiwiY29uZ3JhdHVsYXRlIiwiZ2FtZU9mRXZlbiIsIm1heE51bSIsImluc3RydWN0aW9uIiwiZ2VuZXJhdG9yIiwiZ2VuZXJhdGVkTnVtYmVyIiwiTWF0aCIsImZsb29yIiwicmFuZG9tIiwiaXNFdmVuIiwicmVzdWx0IiwiZ2FtZU9mQ2FsYyIsIm1heE51bTIiLCJnZW5OdW0xIiwiZ2VuTnVtMiIsImV4cFN5bWJvbHMiLCJzdHIiLCJmIiwiYSIsImIiLCJ0cmFuc1N5bWJvbCIsImdlblF1ZXN0aW9uIiwiU3RyaW5nIiwiZ2FtZU9mR0NEIiwibm9kIiwiZ2VuTk9EIiwiZ2FtZU9mUHJvZ3Jlc3Npb24iLCJwcm9nQ291bnQiLCJtaW5TdGVwIiwibWF4U3RlcCIsImFsdGVyZWRQcm9nQ291bnQiLCJzdGVwIiwiZ2VuSXRlciIsImxhc3ROdW0iLCJpIiwibmV3TGFzdE51bSIsInB1c2giLCJnZW5Qcm9ncmVzc2lvbiIsImdlbk1pc3NpbmdOdW1JbmRleCIsImFuc3dlciIsImpvaW4iLCJwbGF5R2FtZSIsImdhbWUiLCJudW1Db3JyZWN0R2FtZXMiLCJ1c2VyQW5zd2VyIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7Ozs7QUFFQSxNQUFNQSxVQUFVLEdBQUcsTUFBTTtBQUN2QkMsRUFBQUEsT0FBTyxDQUFDQyxHQUFSLENBQVksK0JBQVo7QUFDRCxDQUZEOzs7O0FBSUEsTUFBTUMsdUJBQXVCLEdBQUcsTUFBTTtBQUNwQyxRQUFNQyxJQUFJLEdBQUdDLHNCQUFhQyxRQUFiLENBQXNCLDBCQUF0QixDQUFiOztBQUNBTCxFQUFBQSxPQUFPLENBQUNDLEdBQVIsQ0FBYSxZQUFXRSxJQUFLLEVBQTdCO0FBQ0EsU0FBT0EsSUFBUDtBQUNELENBSkQ7Ozs7QUFNQSxN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QUFjQSxRQUFTLGlCQUE5QyxDQUFuQjs7QUFDQSxRQUFJNkMsVUFBVSxLQUFLTCxNQUFuQixFQUEyQjtBQUN6QjdDLE1BQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZLFVBQVo7QUFDQXVDLE1BQUFBLENBQUMsSUFBSSxDQUFMO0FBQ0QsS0FIRCxNQUdPeEMsT0FBTyxDQUFDQyxHQUFSLENBQWEsSUFBR2lELFVBQVcsNkNBQTRDTCxNQUFPLEdBQTlFO0FBQ1I7O0FBQ0R2QyxFQUFBQSxZQUFZLENBQUNILElBQUQsQ0FBWjtBQUNELENBZkQiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgcmVhZGxpbmVTeW5jIGZyb20gJ3JlYWRsaW5lLXN5bmMnO1xuXG5jb25zdCBzYXlXZWxjb21lID0gKCkgPT4ge1xuICBjb25zb2xlLmxvZygnXFxuV2VsY29tZSB0byB0aGUgQnJhaW4gR2FtZXMhJyk7XG59O1xuXG5jb25zdCBxdWVzdGlvbk5hbWVBbmRTYXlIZWxsbyA9ICgpID0+IHtcbiAgY29uc3QgbmFtZSA9IHJlYWRsaW5lU3luYy5xdWVzdGlvbignXFxuTWF5IEkgaGF2ZSB5b3VyIG5hbWU/ICcpO1xuICBjb25zb2xlLmxvZyhgXFxuSGVsbG8sICR7bmFtZX1gKTtcbiAgcmV0dXJuIG5hbWU7XG59O1xuXG5jb25zdCBjb25ncmF0dWxhdGUgPSBuYW1lID0+IGNvbnNvbGUubG9nKGBcXG5Db25ncmF0dWxhdGlvbnMsICR7bmFtZX0hYCk7XG4vLyBldmVyeSBnYW1lIHJldHVybnMgW3N0cmluZywgZnVuY3Rpb25dIGZ1bmN0aW9uIGlzIGdlbmVyYXRvciBvZiBbcXVlc3Rpb24sIGFuc3dlcl1cbmNvbnN0IGdhbWVPZkV2ZW4gPSAobWF4TnVtID0gNTApID0+ICgpID0+IHtcbiAgY29uc3QgaW5zdHJ1Y3Rpb24gPSAnQW53c2VyIFwieWVzXCIgaWYgbnVtYmVyIGV2ZW4gb3RoZXJ3aXNlIGFuc3dlciBcIm5vXCInO1xuICBjb25zdCBnZW5lcmF0b3IgPSAoKSA9PiB7XG4gICAgY29uc3QgZ2VuZXJhdGVkTnVtYmVyID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogbWF4TnVtKTtcbiAgICBjb25zdCBpc0V2ZW4gPSAoZ2VuZXJhdGVkTnVtYmVyICUgMiA9PT0gMCk7XG4gICAgY29uc3QgcmVzdWx0ID0gKGlzRXZlbiA/ICd5ZXMnIDogJ25vJyk7XG4gICAgcmV0dXJuIFtnZW5lcmF0ZWROdW1iZXIsIHJlc3VsdF07XG4gIH07XG4gIHJldHVybiBbaW5zdHJ1Y3Rpb24sIGdlbmVyYXRvcl07XG59O1xuXG5jb25zdCBnYW1lT2ZDYWxjID0gKG1heE51bSA9IDUwLCBtYXhOdW0yID0gbWF4TnVtIC8gNSkgPT4gKCkgPT4ge1xuICBjb25zdCBpbnN0cnVjdGlvbiA9ICdXaGF0IGlzIHJlc3VsdCBvZiB0aGUgZXhwcmVzc2lvbj8nO1xuICBjb25zdCBnZW5lcmF0b3IgPSAoKSA9PiB7XG4gICAgY29uc3QgZ2VuTnVtMSA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIG1heE51bSk7XG4gICAgY29uc3QgZ2VuTnVtMiA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIG1heE51bTIpO1xuICAgIGNvbnN0IGV4cFN5bWJvbHMgPSBbXG4gICAgICB7IHN0cjogJysnLCBmOiAoYSwgYikgPT4gYSArIGIgfSxcbiAgICAgIHsgc3RyOiAnLScsIGY6IChhLCBiKSA9PiBhIC0gYiB9LFxuICAgICAgeyBzdHI6ICcqJywgZjogKGEsIGIpID0+IGEgKiBiIH0sXG4gICAgXTtcbiAgICBjb25zdCB0cmFuc1N5bWJvbCA9IGV4cFN5bWJvbHNbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMyldO1xuICAgIGNvbnN0IGdlblF1ZXN0aW9uID0gYCR7Z2VuTnVtMX0gJHt0cmFuc1N5bWJvbC5zdHJ9ICR7Z2VuTnVtMn1gO1xuICAgIGNvbnN0IHJlc3VsdCA9IFN0cmluZyh0cmFuc1N5bWJvbC5mKGdlbk51bTEsIGdlbk51bTIpKTtcbiAgICByZXR1cm4gW2dlblF1ZXN0aW9uLCByZXN1bHRdO1xuICB9O1xuICByZXR1cm4gW2luc3RydWN0aW9uLCBnZW5lcmF0b3JdO1xufTtcblxuY29uc3QgZ2FtZU9mR0NEID0gKG1heE51bSA9IDUwKSA9PiAoKSA9PiB7XG4gIGNvbnN0IGluc3RydWN0aW9uID0gJ0ZpbmQgdGhlIGdyZWF0ZXN0IGNvbW1vbiBkaXZpc29yIG9mIGdpdmVuIG51bWJlcnMuJztcbiAgY29uc3QgZ2VuZXJhdG9yID0gKCkgPT4ge1xuICAgIGNvbnN0IGdlbk51bTEgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBtYXhOdW0pO1xuICAgIGNvbnN0IGdlbk51bTIgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBtYXhOdW0pO1xuICAgIGNvbnN0IG5vZCA9IChhLCBiKSA9PiAoYiA+IDAgPyBub2QoYiwgYSAlIGIpIDogYSk7XG4gICAgY29uc3QgZ2VuTk9EID0gU3RyaW5nKG5vZChnZW5OdW0xLCBnZW5OdW0yKSk7XG4gICAgY29uc3QgZ2VuUXVlc3Rpb24gPSBgJHtnZW5OdW0xfSAke2dlbk51bTJ9YDtcbiAgICByZXR1cm4gW2dlblF1ZXN0aW9uLCBnZW5OT0RdO1xuICB9O1xuICByZXR1cm4gW2luc3RydWN0aW9uLCBnZW5lcmF0b3JdO1xufTtcblxuY29uc3QgZ2FtZU9mUHJvZ3Jlc3Npb24gPSAobWF4TnVtID0gNTAsIHByb2dDb3VudCA9IDEwLCBtaW5TdGVwID0gMixcbiAgbWF4U3RlcCA9IG1pblN0ZXAgKyA5KSA9PiAoKSA9PiB7XG4gIC8vIHlvdSBjYW50IGd1ZXNzIHByb2dyZXNzaW9uIHdpdGggbGVzcyB0aGFuIDMgbnVtYmVycywgc28gZml4IGl0XG4gIGNvbnN0IGFsdGVyZWRQcm9nQ291bnQgPSBwcm9nQ291bnQgPCAzID8gMyA6IHByb2dDb3VudDtcbiAgY29uc3QgaW5zdHJ1Y3Rpb24gPSAnV2hhdCBudW1iZXIgaXMgbWlzc2luZyBpbiB0aGUgcHJvZ3Jlc3Npb24/JztcbiAgY29uc3QgZ2VuZXJhdG9yID0gKCkgPT4ge1xuICAgIGNvbnN0IHN0ZXAgPSBtaW5TdGVwICsgTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogbWF4U3RlcCk7XG4gICAgLy8gaXRlcmF0aXZlIHByb2Nlc3MgLSBnZW5lcmF0ZXMgYXJyYXlcbiAgICBjb25zdCBnZW5JdGVyID0gKHJlc3VsdCwgbGFzdE51bSwgaSkgPT4ge1xuICAgICAgaWYgKGkgPT09IDApIHJldHVybiByZXN1bHQ7XG4gICAgICBjb25zdCBuZXdMYXN0TnVtID0gbGFzdE51bSArIHN0ZXA7XG4gICAgICByZXN1bHQucHVzaChuZXdMYXN0TnVtKTtcbiAgICAgIHJldHVybiBnZW5JdGVyKHJlc3VsdCwgbmV3TGFzdE51bSwgaSAtIDEpO1xuICAgIH07XG4gICAgY29uc3QgZ2VuUHJvZ3Jlc3Npb24gPSBnZW5JdGVyKFtdLCBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBtYXhOdW0pLCBhbHRlcmVkUHJvZ0NvdW50KTtcbiAgICAvLyBnZW5lcmF0ZWQgbWlzc2luZyBudW1iZXIgaW5kZXhcbiAgICBjb25zdCBnZW5NaXNzaW5nTnVtSW5kZXggPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBhbHRlcmVkUHJvZ0NvdW50KTtcbiAgICBjb25zdCBhbnN3ZXIgPSBTdHJpbmcoZ2VuUHJvZ3Jlc3Npb25bZ2VuTWlzc2luZ051bUluZGV4XSk7XG4gICAgLy8gcmVwbGFjZSBtaXNzaW5nIGluZGV4IHdpdGggdHdvIGRvdHNcbiAgICBnZW5Qcm9ncmVzc2lvbltnZW5NaXNzaW5nTnVtSW5kZXhdID0gJy4uJztcbiAgICBjb25zdCBxdWVzdGlvbiA9IGdlblByb2dyZXNzaW9uLmpvaW4oJyAnKTtcbiAgICByZXR1cm4gW3F1ZXN0aW9uLCBhbnN3ZXJdO1xuICB9O1xuICByZXR1cm4gW2luc3RydWN0aW9uLCBnZW5lcmF0b3JdO1xufTtcblxuY29uc3QgcGxheUdhbWUgPSAoZ2FtZSwgbnVtQ29ycmVjdEdhbWVzID0gMykgPT4ge1xuICBzYXlXZWxjb21lKCk7XG4gIGNvbnN0IG5hbWUgPSBxdWVzdGlvbk5hbWVBbmRTYXlIZWxsbygpO1xuXG4gIGNvbnN0IFtpbnN0cnVjdGlvbiwgZ2VuZXJhdG9yXSA9IGdhbWUoKTtcbiAgY29uc29sZS5sb2coYFxcbiR7aW5zdHJ1Y3Rpb259YCk7XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtQ29ycmVjdEdhbWVzOykge1xuICAgIGNvbnN0IFtxdWVzdGlvbiwgYW5zd2VyXSA9IGdlbmVyYXRvcigpO1xuICAgIGNvbnN0IHVzZXJBbnN3ZXIgPSByZWFkbGluZVN5bmMucXVlc3Rpb24oYFxcblF1ZXN0aW9uOiAke3F1ZXN0aW9ufVxcbllvdXIgYW5zd2VyOiBgKTtcbiAgICBpZiAodXNlckFuc3dlciA9PT0gYW5zd2VyKSB7XG4gICAgICBjb25zb2xlLmxvZygnQ29ycmVjdCEnKTtcbiAgICAgIGkgKz0gMTtcbiAgICB9IGVsc2UgY29uc29sZS5sb2coYCcke3VzZXJBbnN3ZXJ9JyBpcyB3cm9uZyBhbnN3ZXIgOyguIENvcnJlY3QgYW5zd2VyIHdhcyAnJHthbnN3ZXJ9J2ApO1xuICB9XG4gIGNvbmdyYXR1bGF0ZShuYW1lKTtcbn07XG5cbmV4cG9ydCB7XG4gIHNheVdlbGNvbWUsIHF1ZXN0aW9uTmFtZUFuZFNheUhlbGxvLCBjb25ncmF0dWxhdGUsXG4gIGdhbWVPZkV2ZW4sIGdhbWVPZkNhbGMsIGdhbWVPZkdDRCwgZ2FtZU9mUHJvZ3Jlc3Npb24sXG4gIHBsYXlHYW1lLFxufTtcbiJdfQ==